<app-header-and-sidebar></app-header-and-sidebar>

<br>
<br>
<br>
<br>
<div class="content" [class.collapsed]="!isSidebarVisible">
  <div class="container mt-4">

      <div class="d-flex justify-content-center mb-4">
        <label for="date" class="form-label">Sélectionnez une date :</label>
        <input
          type="date"
          id="date"
          [(ngModel)]="selectedDate"
          class="form-control"
          placeholder="yyyy-mm-dd"
          (change)="onDateChange()"
        />
      </div>
      <div class="col-md-8 d-flex align-items-end">
        <button
          class="btn btn-primary me-2"
          (click)="getPresences('employe')"
        >
          <i class="fa fa-briefcase"></i> Voir les employés
        </button>
        <button
          class="btn btn-secondary"
          (click)="getPresences('apprenant')"
        >
          <i class="fa fa-user-graduate"></i> Voir les apprenants
        </button>
      </div>
      <br>
      <br>

    <!-- Barre de recherche -->
    <div class="row mb-3">
      <div class="col-md-6">
        <input
          type="text"
          class="form-control"
          placeholder="Rechercher par nom, prénom ou cohorte/département"
          [(ngModel)]="searchQuery"
          (input)="filterPresences()"
        />
      </div>
    </div>

    <div *ngIf="loading" class="text-center my-3">
      <div class="spinner-border" role="status">
        <span class="visually-hidden">Chargement...</span>
      </div>
    </div>

    <div *ngIf="error" class="alert alert-danger">
      {{ error }}
    </div>

    <!-- Tableau des présences -->
    <table *ngIf="filteredPresences.length > 0" class="table table-striped table-hover mt-3">
      <thead class="table-dark">
        <tr>
          <th>Nom</th>
          <th>Prénom</th>
          <th>Cohorte / Département</th>
          <th>Heure d'arrivée</th>
          <th>Retard à l'arrivée</th>
          <th>Heure de départ</th>
          <th>Retard au départ</th>
          <th>Statut</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let presence of filteredPresences">
          <td>{{ presence.nom }}</td>
          <td>{{ presence.prenom }}</td>
          <td>{{ presence.nomDepartementOuCohorte }}</td>
          <td>{{ presence.heure_arrivee }}</td>
          <td [ngClass]="{
              'text-danger': presence.retardArrivee !== 'À l\'heure',
              'text-success': presence.retardArrivee === 'À l\'heure' || presence.retardArrivee === 'Retard positif'
            }">
            {{ presence.retardArrivee }}
          </td>
          <td>{{ presence.heure_depart }}</td>
          <td [ngClass]="{
              'text-danger': presence.retardDepart !== 'À l\'heure',
              'text-success': presence.retardDepart === 'À l\'heure' || presence.retardDepart === 'Retard négatif'
            }">
            {{ presence.retardDepart }}
          </td>
          <td>{{ presence.status }}</td>
        </tr>
      </tbody>
    </table>

    <div *ngIf="filteredPresences.length === 0 && !loading" class="text-center mt-3">
      <p>Aucune donnée disponible ou correspondante à votre recherche.</p>
    </div>
  </div>
</div>
